(()=>{"use strict";class e{constructor(e,t,s,n){this._data=e,this._templateElement=t,this._openCard=s}_getElement(){const e=document.querySelector(this._templateElement).content.querySelector(".element").cloneNode(!0);this._element=e,this._imageElement=this._element.querySelector(".element__image"),this._titleElement=this._element.querySelector(".element__title")}generateCard(){return this._getElement(),this._setEventListeners(),this._imageElement.src=this._data.link,this._imageElement.alt=this._data.name,this._titleElement.textContent=this._data.name,this._element}_toggleCardLikeState(e){e.target.classList.toggle("element__like_active")}_removeCard(){this._element.remove()}_setEventListeners(){this._element.querySelector(".element__like").addEventListener("click",this._toggleCardLikeState),this._element.querySelector(".element__basket").addEventListener("click",(()=>{})),this._imageElement.addEventListener("click",(()=>{this._openCard(this._imageElement,this._data.name)}))}}class t{constructor(e,t){this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}_validateInput(e){e.validity.valid?this._hideError(e):this._showError(e)}_showError(e){const t=this._formElement.querySelector(`.${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideError(e){const t=this._formElement.querySelector(`.${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_addInputListeners(){this._toggleButtonState(),this._inputsList.forEach((e=>{e.addEventListener("input",(()=>{this._validateInput(e),this._toggleButtonState()}))}))}_isFormValid(){return this._inputsList.every((e=>e.validity.valid))}_toggleButtonState(){this._isFormValid()?this._enableSubmitButton(this._buttonElement):this.disableSubmitButton(this._buttonElement)}_enableSubmitButton(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0)}disableSubmitButton(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}clearErrors(){this._inputsList.forEach((e=>{this._hideError(e)}))}enableValidation(){this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._inputsList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._addInputListeners()}}class s{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-icon"))&&this.close()}))}}class n extends s{constructor(e,t){super(e),this._formElement=document.forms[`${this._popupElement.id}-form`],this._submitFormHandler=t,this._inputList=this._formElement.querySelectorAll(".popup__input")}_getInputValues(){return this._inputValues={},this._inputList.forEach((e=>{this._inputValues[e.name]=e.value})),this._inputValues}setDefaultInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._submitFormHandler(this._getInputValues()),this.close()}))}close(){super.close(),this._formElement.reset()}}class o{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const r=new class{constructor(e){this._options=e,this._cardsEndpoint=`${this._options.baseUrl}/cards`,this._userEndpoint=`${this._options.baseUrl}/users/me`,this._authorization=this._options.headers.authorization,this._contentType=this._options.headers["Content-Type"]}getInitialCards(){return fetch(this._cardsEndpoint,{headers:{authorization:this._authorization}}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch((e=>{console.log(`От сервера вернулась ошибка ${e}`)}))}getUser(){return fetch(this._userEndpoint,{headers:{authorization:this._authorization}}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch((e=>{console.log(`От сервера вернулась ошибка ${e}`)}))}patchUser(e){return fetch(this._userEndpoint,{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({name:e.name,about:e.about})}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch((e=>{console.log(`От сервера вернулась ошибка ${e}`)}))}postNewCard(e){return fetch(this._cardsEndpoint,{method:"POST",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({name:e.name,link:e.link})}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch((e=>{console.log(`От сервера вернулась ошибка ${e}`)}))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-55",headers:{authorization:"d336096d-2d8c-44f4-af75-d1804dff5c64","Content-Type":"application/json"}}),i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},a=document.querySelector(".profile__edit-button"),l=document.querySelector("#edit-profile").querySelector(".popup__container").querySelector(".popup__form"),u=document.querySelector(".profile__add-button"),_=document.querySelector("#add-place").querySelector(".popup__container").querySelector(".popup__form"),c=new t(i,l),h=new t(i,_),p=new class extends s{constructor(e){super(e),this._popupImage=this._popupElement.querySelector(".popup__image"),this._popupTitle=this._popupElement.querySelector(".popup__caption")}open(e,t){this._popupImage.src=e.src,this._popupImage.alt=t,this._popupTitle.textContent=t,super.open()}}("#element-popup"),m=(new s("#delete-place"),new n("#add-place",(e=>{const t=new o({},".elements__list");r.postNewCard(e),t.addItem(S(e)),h.disableSubmitButton()}))),d=new n("#edit-profile",(e=>{r.patchUser(e).then((e=>{E.setUserInfo(e)})),c.disableSubmitButton()}));r.getInitialCards().then((e=>{const t=new o({items:e.reverse(),renderer:e=>{t.addItem(S(e))}},".elements__list");t.renderItems()}));const E=new class{constructor({userNameSelector:e,userInfoSelector:t,userAvatarSelector:s}){this._userNameElement=document.querySelector(e),this._userInfoElement=document.querySelector(t),this._userAvatarElement=document.querySelector(s)}getUserInfo(){const e={};return e.name=this._userNameElement.textContent,e.about=this._userInfoElement.textContent,e}setUserInfo(e){this._userNameElement.textContent=e.name,this._userInfoElement.textContent=e.about,this._userAvatarElement.src=e.avatar}}({userNameSelector:".profile__name",userInfoSelector:".profile__about",userAvatarSelector:".profile__photo"});function S(t){return new e(t,"#element",((e,t)=>{p.open(e,t)})).generateCard()}r.getUser().then((e=>{E.setUserInfo(e)})),p.setEventListeners(),m.setEventListeners(),d.setEventListeners(),c.enableValidation(),h.enableValidation(),a.addEventListener("click",(()=>{c.clearErrors(),d.open(),d.setDefaultInputValues(E.getUserInfo())})),u.addEventListener("click",(()=>{h.clearErrors(),m.open()}))})();